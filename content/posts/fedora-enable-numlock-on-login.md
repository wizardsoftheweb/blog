---
title: "Fedora 28: Enable NumLock on Login"
slug: "fedora-enable-numlock-on-login"
date: "2018-05-21T00:00:00.000Z"
author: "CJ Harries"
description: "This is generic enough it should work in other distros with modification. This post walks through a user service solution via systemd and numlockx."
tags:
  - systemd
  - Fedora
  - Linux
  - NumLock
  - Automation
  - service
  - numlockx
  - CLI
draft: true
---

I lost my primary drive on Friday, and I'm having to rebuild a bunch of stuff. I didn't document minor things like this before, so I am this time around. Hopefully someone else finds this useful.

## `numlockx`

There are plenty of different ways to enable NumLock on login, including [a decent manual approach](https://wiki.archlinux.org/index.php/Activating_Numlock_on_Bootup). An official X extension, `numlockx`, can handle it automatically for us. There's [an unofficial mirror](https://github.com/rg3/numlockx) available to build the package from source, or you can check for it in official channels.

<table class="highlighttable" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><tr><td class="code" style="border:none; background-image:none; background-position:center; background-repeat:no-repeat; padding:10px 0">
<div class="highlight" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><pre style="background:#272822; color:#f8f8f2; border:none; font-size:1em; line-height:125%; padding:10px; margin-bottom:0; margin-top:0; padding-bottom:0; padding-top:0"><span></span><span class="gp" style="color:#66d9ef">$</span> dnf search numlockx<br><span class="go" style="color:#888">Last metadata expiration check: 0:56:24 ago on Sun 20 May 2018 04:02:40 PM CDT.</span><br><span class="go" style="color:#888">==================================== Name Exactly Matched: numlockx ====================================</span><br><span class="go" style="color:#888">numlockx.x86_64 : Turns on NumLock after starting X</span><br><br><span class="gp" style="color:#66d9ef">$</span> sudo dnf install -y numlockx<br><span class="go" style="color:#888">Last metadata expiration check: 0:47:47 ago on Sun 20 May 2018 04:02:40 PM CDT.</span><br><span class="go" style="color:#888">Dependencies resolved.</span><br><span class="go" style="color:#888">========================================================================================================</span><br><span class="go" style="color:#888"> Package                 Arch                  Version                      Repository             Size</span><br><span class="go" style="color:#888">========================================================================================================</span><br><span class="go" style="color:#888">Installing:</span><br><span class="go" style="color:#888"> numlockx                x86_64                1.2-12.fc27                  fedora                 18 k</span><br><br><span class="go" style="color:#888">Transaction Summary</span><br><span class="go" style="color:#888">========================================================================================================</span><br><span class="go" style="color:#888">Install  1 Package</span><br><br><span class="go" style="color:#888">Total download size: 18 k</span><br><span class="go" style="color:#888">Installed size: 17 k</span><br><span class="go" style="color:#888">Downloading Packages:</span><br><span class="go" style="color:#888">numlockx-1.2-12.fc27.x86_64.rpm                                          47 kB/s |  18 kB     00:00</span><br><span class="go" style="color:#888">--------------------------------------------------------------------------------------------------------</span><br><span class="go" style="color:#888">Total                                                                    18 kB/s |  18 kB     00:00</span><br><span class="go" style="color:#888">Running transaction check</span><br><span class="go" style="color:#888">Transaction check succeeded.</span><br><span class="go" style="color:#888">Running transaction test</span><br><span class="go" style="color:#888">Transaction test succeeded.</span><br><span class="go" style="color:#888">Running transaction</span><br><span class="go" style="color:#888">  Preparing        :                                                                                1/1</span><br><span class="go" style="color:#888">  Installing       : numlockx-1.2-12.fc27.x86_64                                                    1/1</span><br><span class="go" style="color:#888">  Running scriptlet: numlockx-1.2-12.fc27.x86_64                                                    1/1</span><br><span class="go" style="color:#888">  Verifying        : numlockx-1.2-12.fc27.x86_64                                                    1/1</span><br><br><span class="go" style="color:#888">Installed:</span><br><span class="go" style="color:#888">  numlockx.x86_64 1.2-12.fc27</span><br><br><span class="go" style="color:#888">Complete!</span><br></pre></div>
</td></tr></table>

As far as I know, there aren't any problems installing the older version from 27 in 28. `numlockx` is a fairly simple package that depends on `xkb` which, as of writing, has not yet been updated drastically enough to worry.

## Automating

The [previously linked ArchWiki page](https://wiki.archlinux.org/index.php/Activating_Numlock_on_Bootup#X.org) has good explanations for common configurations. I'm not entirely sure any of them will work with [`i3`](https://i3wm.org/), so this solution uses `systemd`. A unit file will let us connect the action to logging in, and using [the user configuration](https://wiki.archlinux.org/index.php/Systemd/User) we won't affect any other users.

<table class="highlighttable" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><tr><td class="code" style="border:none; background-image:none; background-position:center; background-repeat:no-repeat; padding:10px 0">
<div class="highlight" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><pre style="background:#272822; color:#f8f8f2; border:none; font-size:1em; line-height:125%; padding:10px; margin-bottom:0; margin-top:0; padding-bottom:0; padding-top:0"><span></span><span class="gp" style="color:#66d9ef">$</span> mkdir -p ~/.config/systemd/user<br><span class="gp" style="color:#66d9ef">$</span> <span class="nv" style="color:#f8f8f2">$EDITOR</span> ~/.config/systemd/user/numlockx.service<br></pre></div>
</td></tr></table>

<table class="highlighttable" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%">
<tr class="code-header" style="height:40px; padding:5px 0 0" height="40">
<td style="border:none; background-image:none; background-position:center; background-repeat:no-repeat"></td>
<td class="code-header" style="border:none; background-image:none; background-position:center; background-repeat:no-repeat; height:40px; padding:5px 0 0" height="40"><div class="code-tab active" style="color:#f8f8f2; display:inline-block; font-size:0.9em; height:35px; line-height:35px; margin:0 30px 0 0; padding:0 5px; border-bottom:1px solid #57584f" height="35">~/.config/systemd/user/numlockx.service</div></td>
</tr>
<tr>
<td class="linenos" style="border:none; background-image:none; background-position:center; background-repeat:no-repeat; padding:10px 0"><div class="linenodiv"><pre style="background:#272822; color:#57584f; border:none; font-size:1em; line-height:125%; padding:0 10px; margin-bottom:0; margin-top:0; padding-bottom:0; padding-top:0; border-radius:0; border-right:1px solid #57584f"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td>
<td class="code" style="border:none; background-image:none; background-position:center; background-repeat:no-repeat; padding:10px 0">
<div class="highlight" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><pre style="background:#272822; color:#f8f8f2; border:none; font-size:1em; line-height:125%; padding:10px; margin-bottom:0; margin-top:0; padding-bottom:0; padding-top:0"><span></span><span class="k" style="color:#66d9ef">[Unit]</span><br><span class="na" style="color:#a6e22e">Description</span><span class="o" style="color:#f92672">=</span><span class="s" style="color:#e6db74">Turn on NumLock</span><br><span class="na" style="color:#a6e22e">BindsTo</span><span class="o" style="color:#f92672">=</span><span class="s" style="color:#e6db74">graphical-session.target</span><br><br><span class="k" style="color:#66d9ef">[Service]</span><br><span class="na" style="color:#a6e22e">Type</span><span class="o" style="color:#f92672">=</span><span class="s" style="color:#e6db74">oneshot</span><br><span class="na" style="color:#a6e22e">RemainAfterExit</span><span class="o" style="color:#f92672">=</span><span class="s" style="color:#e6db74">yes</span><br><span class="na" style="color:#a6e22e">ExecStart</span><span class="o" style="color:#f92672">=</span><span class="s" style="color:#e6db74">/usr/bin/numlockx on</span><br><span class="na" style="color:#a6e22e">ExecStop</span><span class="o" style="color:#f92672">=</span><span class="s" style="color:#e6db74">/usr/bin/numlockx off</span><br><br><span class="k" style="color:#66d9ef">[Install]</span><br><span class="na" style="color:#a6e22e">WantedBy</span><span class="o" style="color:#f92672">=</span><span class="s" style="color:#e6db74">graphical-session.target</span><br></pre></div>
</td>
</tr>
</table>

This creates [a `oneshot` service](https://www.freedesktop.org/software/systemd/man/systemd.service.html#Type=) whose process is launched from the `ExecStart` line but exits before other units are fired. By adding [the `RemainAfterExit` option](https://www.freedesktop.org/software/systemd/man/systemd.service.html#RemainAfterExit=), `systemd` will report it as active even after the process exits. `numlockx` tweaks X settings and leaves; it doesn't run perpetually. `systemd` will automatically stop any user processes when we exit; however, we don't have a process, so the `ExecStop` line will undo any changes we've made. Because `numlockx` only touches NumLock in X, we install it to [the `graphical-session.target`](http://man7.org/linux/man-pages/man7/systemd.special.7.html#SPECIAL_PASSIVE_USER_UNITS) via `WantedBy`. This target is only available to users, not globally. If you want to install it with a different target, e.g. one you've made, [double check the available targets](https://wiki.archlinux.org/index.php/systemd#Targets) and update it as you see fit. Finally, the `BindsTo` line links the service to the `graphical-session.target`, meaning the service ends with the target.

Once it's built, all you have to do is enable the service and you're good to go. Below I do a more rigorous start, reloading my user services, starting to ensure it doesn't fail, and only then enabling.

<table class="highlighttable" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><tr><td class="code" style="border:none; background-image:none; background-position:center; background-repeat:no-repeat; padding:10px 0">
<div class="highlight" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><pre style="background:#272822; color:#f8f8f2; border:none; font-size:1em; line-height:125%; padding:10px; margin-bottom:0; margin-top:0; padding-bottom:0; padding-top:0"><span></span><span class="gp" style="color:#66d9ef">$</span> systemctl --user daemon-reload<br><br><span class="gp" style="color:#66d9ef">$</span> systemctl --user status numlockx.service<br><span class="go" style="color:#888">● numlockx.service - Turn on NumLock</span><br><span class="go" style="color:#888">   Loaded: loaded (/home/cjharries/.config/systemd/user/numlockx.service; disabled; vendor preset: enab&gt;</span><br><span class="go" style="color:#888">   Active: inactive (dead)</span><br><br><span class="gp" style="color:#66d9ef">$</span> systemctl --user start numlockx.service<br><br><span class="gp" style="color:#66d9ef">$</span> systemctl --user status numlockx.service<br><span class="go" style="color:#888">● numlockx.service - Turn on NumLock</span><br><span class="go" style="color:#888">   Loaded: loaded (/home/cjharries/.config/systemd/user/numlockx.service; disabled; vendor preset: enab&gt;</span><br><span class="go" style="color:#888">   Active: active (exited) since Sun 2018-05-20 17:48:59 CDT; 1s ago</span><br><span class="go" style="color:#888">  Process: 9578 ExecStart=/usr/bin/numlockx on (code=exited, status=0/SUCCESS)</span><br><span class="go" style="color:#888"> Main PID: 9578 (code=exited, status=0/SUCCESS)</span><br><br><span class="go" style="color:#888">May 20 17:48:59 gxc-fedora-28.wotw systemd[2370]: Starting Turn on NumLock...</span><br><span class="go" style="color:#888">May 20 17:48:59 gxc-fedora-28.wotw systemd[2370]: Started Turn on NumLock.</span><br><br><span class="gp" style="color:#66d9ef">$</span> systemctl --user <span class="nb" style="color:#f8f8f2">enable</span> numlockx.service<br><span class="go" style="color:#888">Created symlink</span><br><span class="go" style="color:#888">/home/cjharries/.config/systemd/user/graphical-session.target.wants/numlockx.service</span><br><span class="go" style="color:#888">→ /home/cjharries/.config/systemd/user/numlockx.service.</span><br><br><span class="go" style="color:#888"># The next time you log in, it should boot automatically</span><br><span class="gp" style="color:#66d9ef">$</span> systemctl --user status numlockx.service<br><span class="go" style="color:#888">● numlockx.service - Turn on NumLock</span><br><span class="go" style="color:#888">   Loaded: loaded (/home/cjharries/.config/systemd/user/numlockx.service; enabled; vendor preset: enabl&gt;</span><br><span class="go" style="color:#888">   Active: active (exited) since Sun 2018-05-20 18:09:18 CDT; 49s ago</span><br><span class="go" style="color:#888">  Process: 4458 ExecStart=/usr/bin/numlockx on (code=exited, status=0/SUCCESS)</span><br><span class="go" style="color:#888"> Main PID: 4458 (code=exited, status=0/SUCCESS)</span><br><br><span class="go" style="color:#888">May 20 18:09:18 gxc-fedora-28.wotw systemd[4333]: Starting Turn on NumLock...</span><br><span class="go" style="color:#888">May 20 18:09:18 gxc-fedora-28.wotw systemd[4333]: Started Turn on NumLock.</span><br></pre></div>
</td></tr></table>

## Note

I'm not incredibly familiar with user services yet (having just started using them heavily [this weekend](https://gist.github.com/thecjharries/0e6ec9ba6209a0dfb5ccc66e1fc1b358#file-2-bootstrap-md)), so I'm not entirely certain about all the `graphical-session.target` logic. I've only rebooted twice now to check the flow, and that's two more times than I normally would in at least a week. If you're on an older distro or using an older version of `systemd`, the target might not exist or work correctly. This command is a good check:

<table class="highlighttable" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><tr><td class="code" style="border:none; background-image:none; background-position:center; background-repeat:no-repeat; padding:10px 0">
<div class="highlight" style='border-radius:5px; display:block; font-family:Consolas, "Courier New", monospace; min-width:300px; overflow:auto; width:100%; background:#272822; color:#f8f8f2' width="100%"><pre style="background:#272822; color:#f8f8f2; border:none; font-size:1em; line-height:125%; padding:10px; margin-bottom:0; margin-top:0; padding-bottom:0; padding-top:0"><span></span><span class="gp" style="color:#66d9ef">$</span> systemctl --user list-units --type<span class="o" style="color:#f92672">=</span>target <span class="p">|</span> grep <span class="s1" style="color:#e6db74">'graphical-session.target.*loaded.*active'</span> <span class="o" style="color:#f92672">||</span> <span class="nb" style="color:#f8f8f2">echo</span> <span class="s1" style="color:#e6db74">'whoops'</span><br></pre></div>
</td></tr></table>
